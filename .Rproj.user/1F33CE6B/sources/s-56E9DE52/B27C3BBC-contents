# Name: JOERIO CHRISTO CHANDRA
# Metric: 702302

# setup
getwd()
setwd("C:/Users/Joerio Chandra/Documents/BENQ/College/Semester 6/Data Science (STIS3023)/ASG/02/")
library(stringr)
library(dplyr)

powercsv<-read.csv("household_power_consumption.txt", sep=';', na.strings = '?', colClasses = c('character','character','numeric','numeric','numeric','numeric','numeric','numeric','numeric'))
View(powercsv)

# subset date from 01-Feb-2007 to 02-Feb-2007
powercsv$Date<-as.Date(powercsv$Date, '%d/%m/%Y')
powercsv<-subset(powercsv, Date>=as.Date("2007-2-1") & Date<=as.Date("2007-2-2"))

# merge the Date and Time columns to DateTime
powercsv$DateTime<-str_c(powercsv$Date, ' ', powercsv$Time)

# remove Date and Time columns
powercsv<-subset(powercsv, select = -Date)
powercsv<-subset(powercsv, select = -Time)
# (move DateTime to first column)
powercsv<-powercsv %>% select(DateTime, everything())

# format DateTime datatype
powercsv$DateTime<-as.POSIXct(powercsv$DateTime)



# ---PLOT---
# Plot1
hist(powercsv$Global_active_power, main='Global Active Power (Plot 1)', xlab='Global Active Power (Kilowatts)', col='red')
dev.copy(png, 'plot1.png', width=480, height=480)
dev.off()

# Plot2
plot(powercsv$Global_active_power~powercsv$DateTime, type="l", ylab="Global Active Power (Kilowatts)", xlab="2-Day Period", main="Global Active Power (Plot 2)")
dev.copy(png, 'plot2.png', width=480, height=480)
dev.off()

# Plot3
with(powercsv, {
  plot(Sub_metering_1~DateTime, type="l",
       main="Global Active Power (Plot 3)", xlab="2-Day Period", ylab="Global Active Power (Kilowatts)")
  lines(Sub_metering_2~DateTime,col='Red')
  lines(Sub_metering_3~DateTime,col='Blue')
})
legend("topright", col=c("black", "red", "blue"), lwd=c(1,1,1), 
       legend=c("Sub_metering_1", "Sub_metering_2", "Sub_metering_3"))
dev.copy(png, 'plot3.png', width=480, height=480)
dev.off()

# Plot4
par(mfrow=c(2,2), mar=c(4,4,2,1), oma=c(0,0,2,0))
with(powercsv, {
  plot(Global_active_power~DateTime, type="l", 
       ylab="Global Active Power (Kilowatts)", xlab="")
  plot(Voltage~DateTime, type="l", 
       ylab="Voltage (Volt)", xlab="")
  plot(Sub_metering_1~DateTime, type="l", 
       ylab="Global Active Power (Kilowatts)", xlab="")
  lines(Sub_metering_2~DateTime,col='Red')
  lines(Sub_metering_3~DateTime,col='Blue')
  legend("topright", col=c("black", "red", "blue"), lty=1, lwd=2, bty="n",
         legend=c("Sub_metering_1", "Sub_metering_2", "Sub_metering_3"))
  plot(Global_reactive_power~DateTime, type="l", 
       ylab="Global Reactive Power (Kilowatts)",xlab="")
})
mtext("Global Active Power Household (Plot 4)", outer=TRUE)
dev.copy(png ,'plot4.png', width=480, height=480)
dev.off()


# ---LINEAR REGRESSION PLOT---
plot(powercsv$Global_active_power, powercsv$Voltage, main="Relationship of Voltage with Global Active Power", pch=20, col="red", xlab="Global Active Power (Kilowatts)", ylab="Voltage (Volt)")
model<-lm(Voltage~Global_active_power, powercsv)
abline(model, lwd=2, col="blue")

# [ My Opinion on the Linear Regression Plot ]
# This particular model is called simple linear regression.
# It is because we tried to estimate the relationship of
# one dependent variable (Voltage) and independent variable (Global_active_power).
#
# Based on the dots and line in the plot, we can see it is underfitted.
# One of the reasons is the lack of data variance and perhaps data cleaning.
# That is why the line does not cover most of the points in the plot.